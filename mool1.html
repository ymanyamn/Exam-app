<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>POS Cashier</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#020617">

<style>
:root{
  --bg:#020617;
  --card:#111827;
  --primary:#22c55e;
  --danger:#ef4444;
  --accent:#0ea5e9;
  --text:#fff;
}
*{box-sizing:border-box;font-family:system-ui}
html,body{
  margin:0;height:100dvh;background:var(--bg);
  color:var(--text);overflow:hidden;
}
header,nav{
  height:56px;background:#020617;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 12px;
}
nav{justify-content:space-around}
main{
  height:calc(100dvh - 112px);
  overflow:auto;padding:10px;
}
button,input{
  width:100%;padding:12px;margin-top:6px;
  border:none;border-radius:12px;
}
input{background:#1e293b;color:#fff}
button.primary{background:var(--accent)}
button.success{background:var(--primary)}
button.danger{background:var(--danger)}
.card{
  background:var(--card);
  border-radius:16px;padding:12px;margin-bottom:10px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:10px;
}
.product{
  background:#020617;border-radius:14px;
  padding:8px;text-align:center;
}
.product img{
  width:100%;height:90px;
  object-fit:cover;border-radius:10px;
}
.hidden{display:none}
.notice{
  background:#fde68a;color:#000;
  padding:8px;border-radius:12px;margin-bottom:6px;
}
#status{font-size:12px;padding:4px 10px;border-radius:20px}
.active{background:#166534}
</style>
</head>

<body>

<header>
  <b>ğŸ§¾ ÙƒØ§Ø´ÙŠØ±</b>
  <div id="status">ØºÙŠØ± Ù…ÙØ¹Ù„</div>
</header>

<main>

<div id="add" class="card">
  <b>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</b>

  <video id="video" playsinline muted class="hidden"></video>
  <canvas id="canvas" class="hidden"></canvas>

  <button onclick="startCamera()">ğŸ“· ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
  <button onclick="switchCamera()">ğŸ” ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
  <button onclick="capture()">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©</button>

  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
  <input id="code" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ø§Ø¯Ø©">
  <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">

  <button class="primary" onclick="saveProduct()">Ø­ÙØ¸</button>
</div>

<div id="products" class="card hidden">
  <b>ğŸ“¦ Ø§Ù„Ù…ÙˆØ§Ø¯</b>
  <div class="grid" id="list"></div>
</div>

<div id="invoice" class="card hidden">
  <div id="actNotice" class="notice">Ø§Ù„Ù…ÙŠØ²Ø© ØªØ­ØªØ§Ø¬ ØªÙØ¹ÙŠÙ„</div>
  <b>ğŸ§¾ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</b>
  <div id="invoiceList"></div>
</div>

<div id="daily" class="card hidden">
  <b>ğŸ“Š Ø§Ù„Ù…Ø¨ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ…ÙŠ</b>
  <div id="dailyList"></div>
</div>

</main>

<nav>
  <button onclick="tab('add')">â•</button>
  <button onclick="tab('products')">ğŸ“¦</button>
  <button onclick="tab('invoice')">ğŸ§¾</button>
  <button onclick="tab('daily')">ğŸ“Š</button>
</nav>

<!-- ğŸ”Š ØµÙˆØª Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
<audio id="beep">
<source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YRAAAAAA/////w==" type="audio/wav">
</audio>

<script>
/* ===== ØªÙØ¹ÙŠÙ„ ===== */
const CODE="0952725590";
let activated=localStorage.getItem("act")==="1";
const status=document.getElementById("status");
function refresh(){
  status.textContent=activated?"Ù…ÙØ¹Ù„ âœ”":"ØºÙŠØ± Ù…ÙØ¹Ù„";
  status.className=activated?"active":"";
  actNotice.style.display=activated?"none":"block";
}
status.onclick=()=>{
  if(activated) return;
  let c=prompt("ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„");
  if(c===CODE){
    activated=true;
    localStorage.setItem("act","1");
    refresh();
  }
};
refresh();

/* ===== Ø¨ÙŠØ§Ù†Ø§Øª ===== */
let products=JSON.parse(localStorage.getItem("products")||"[]");
let invoice=[];
let daily=JSON.parse(localStorage.getItem("daily")||"{}");

/* ===== ÙƒØ§Ù…ÙŠØ±Ø§ (Ù…ØªÙˆØ§ÙÙ‚ APK) ===== */
let video=document.getElementById("video");
let canvas=document.getElementById("canvas");
let devices=[],currentCam=0,stream;

async function startCamera(){
  devices=(await navigator.mediaDevices.enumerateDevices())
    .filter(d=>d.kind==="videoinput");
  openCam();
}
function openCam(){
  if(stream) stream.getTracks().forEach(t=>t.stop());
  navigator.mediaDevices.getUserMedia({
    video:{deviceId:devices[currentCam]?.deviceId}
  }).then(s=>{
    stream=s;
    video.srcObject=s;
    video.classList.remove("hidden");
  }).catch(()=>alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§"));
}
function switchCamera(){
  if(devices.length<2) return;
  currentCam=(currentCam+1)%devices.length;
  openCam();
}
function capture(){
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
}

/* ===== Ù…Ù†ØªØ¬Ø§Øª ===== */
function saveProduct(){
  products.push({
    name:name.value,
    code:code.value,
    price:+price.value,
    img:canvas.toDataURL()
  });
  localStorage.setItem("products",JSON.stringify(products));
  render();
}
function render(){
  list.innerHTML="";
  products.forEach((p,i)=>{
    list.innerHTML+=`
    <div class="product">
      <img src="${p.img}">
      <b>${p.name}</b><br>
      <small>${p.price}</small>
      <div style="display:flex;gap:6px;margin-top:6px">
        <button class="success" onclick="sell(${i})">âœ…</button>
        <button class="danger">âŒ</button>
      </div>
    </div>`;
  });
}
render();

/* ===== Ø¨ÙŠØ¹ + ØµÙˆØª ===== */
function sell(i){
  document.getElementById("beep").play();
  let p=products[i];
  invoice.push(p);
  let d=new Date().toLocaleDateString();
  daily[d]=daily[d]||{};
  daily[d][p.code]=(daily[d][p.code]||0)+1;
  localStorage.setItem("daily",JSON.stringify(daily));
  showInvoice();
}

/* ===== ÙØ§ØªÙˆØ±Ø© ===== */
function showInvoice(){
  invoiceList.innerHTML="";
  let total=0;
  invoice.forEach(p=>{
    total+=p.price;
    invoiceList.innerHTML+=`<div>${p.name} - ${p.price}</div>`;
  });
  invoiceList.innerHTML+=`<hr><b>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total}</b>`;
}

/* ===== ÙŠÙˆÙ…ÙŠ ===== */
function showDaily(){
  dailyList.innerHTML="";
  Object.keys(daily).forEach(d=>{
    dailyList.innerHTML+=`<b>${d}</b><br>`;
    Object.keys(daily[d]).forEach(c=>{
      dailyList.innerHTML+=`ÙƒÙˆØ¯ ${c}: ${daily[d][c]}<br>`;
    });
    dailyList.innerHTML+="<hr>";
  });
}

/* ===== ØªØ¨ÙˆÙŠØ¨Ø§Øª ===== */
function tab(t){
  ["add","products","invoice","daily"].forEach(x=>{
    document.getElementById(x).classList.add("hidden");
  });
  document.getElementById(t).classList.remove("hidden");
  if(t==="daily") showDaily();
}
</script>

</body>
</html>