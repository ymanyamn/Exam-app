<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>POS Cashier</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#0f172a">

<style>
:root{
  --bg:#0f172a;
  --card:#111827;
  --primary:#22c55e;
  --danger:#ef4444;
  --accent:#0ea5e9;
  --text:#fff;
}
*{box-sizing:border-box;font-family:system-ui}
html,body{
  margin:0;
  padding:0;
  height:100dvh;
  background:var(--bg);
  color:var(--text);
  overflow:hidden;
}
header{
  height:56px;
  background:#020617;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 12px;
}
header b{font-size:15px}
#actStatus{
  font-size:12px;
  padding:4px 10px;
  border-radius:20px;
  background:#7f1d1d;
}
#actStatus.active{background:#166534}

main{
  height:calc(100dvh - 112px);
  overflow:auto;
  padding:10px;
}

nav{
  height:56px;
  display:flex;
  background:#020617;
}
nav button{
  flex:1;
  border:none;
  background:none;
  color:#94a3b8;
  font-size:12px;
}
nav button.active{
  color:var(--accent);
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:12px;
  margin-bottom:10px;
}
input,select,button{
  width:100%;
  margin-top:6px;
  padding:12px;
  border:none;
  border-radius:12px;
  font-size:14px;
}
input,select{background:#1e293b;color:#fff}
button.primary{background:var(--accent)}
button.success{background:var(--primary)}
button.danger{background:var(--danger)}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:10px;
}
.product{
  background:#020617;
  border-radius:14px;
  padding:8px;
  text-align:center;
}
.product img{
  width:100%;
  height:90px;
  object-fit:cover;
  border-radius:10px;
}
.product small{color:#94a3b8}
.actions{
  display:flex;
  gap:6px;
  margin-top:6px;
}
.actions button{padding:8px;font-size:12px}

.notice{
  background:#fde68a;
  color:#000;
  padding:8px;
  border-radius:12px;
  margin-bottom:8px;
  font-size:13px;
}
.hidden{display:none}
</style>
</head>

<body>

<header>
  <b>ğŸ§¾ Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ±</b>
  <div id="actStatus">ØºÙŠØ± Ù…ÙØ¹Ù„</div>
</header>

<main>

<!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
<div id="tabAdd" class="card">
  <b>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</b>
  <video id="cam" autoplay playsinline class="hidden"></video>
  <canvas id="snap" class="hidden"></canvas>
  <button onclick="openCam()">ğŸ“· ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
  <button onclick="switchCam()">ğŸ” ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
  <button onclick="takePhoto()">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø·</button>

  <input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
  <input id="pCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ø§Ø¯Ø©">
  <input id="pPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
  <button class="primary" onclick="saveProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ø§Ø¯Ø©</button>
</div>

<!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div id="tabProducts" class="card hidden">
  <b>ğŸ“¦ Ø§Ù„Ù…ÙˆØ§Ø¯</b>
  <div class="grid" id="productsGrid"></div>
</div>

<!-- Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div id="tabInvoice" class="card hidden">
  <div id="invoiceNotice" class="notice">Ø§Ù„Ù…ÙŠØ²Ø© ØªØ­ØªØ§Ø¬ ØªÙØ¹ÙŠÙ„</div>
  <b>ğŸ§¾ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</b>
  <div id="invoiceList"></div>
  <input id="discount" type="number" placeholder="Ø®ØµÙ… %">
  <button class="success" onclick="printInvoice()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<!-- Ø§Ù„ÙŠÙˆÙ…ÙŠ -->
<div id="tabDaily" class="card hidden">
  <b>ğŸ“Š Ø§Ù„Ù…Ø¨ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ…ÙŠ</b>
  <div id="dailyList"></div>
</div>

</main>

<nav>
  <button class="active" onclick="showTab('Add',this)">â•</button>
  <button onclick="showTab('Products',this)">ğŸ“¦</button>
  <button onclick="showTab('Invoice',this)">ğŸ§¾</button>
  <button onclick="showTab('Daily',this)">ğŸ“Š</button>
</nav>

<script>
/* ====== ØªÙØ¹ÙŠÙ„ ====== */
const ACT_CODE="0952725590";
let activated=localStorage.getItem("activated")==="true";
const actStatus=document.getElementById("actStatus");
function refreshAct(){
  actStatus.textContent=activated?"Ù…ÙØ¹Ù„ âœ”":"ØºÙŠØ± Ù…ÙØ¹Ù„";
  actStatus.className=activated?"active":"";
  document.getElementById("invoiceNotice").style.display=activated?"none":"block";
}
refreshAct();
actStatus.onclick=()=>{
  if(activated) return;
  let c=prompt("Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„");
  if(c===ACT_CODE){
    activated=true;
    localStorage.setItem("activated","true");
    refreshAct();
    alert("ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„");
  }
};

/* ====== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ====== */
let products=JSON.parse(localStorage.getItem("products")||"[]");
let invoice=[];
let daily=JSON.parse(localStorage.getItem("daily")||"{}");

/* ====== Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ====== */
let camStream=null,camFacing="environment";
function openCam(){
  navigator.mediaDevices.getUserMedia({video:{facingMode:camFacing}})
  .then(s=>{
    camStream=s;
    cam.srcObject=s;
    cam.classList.remove("hidden");
  });
}
function switchCam(){
  camFacing=camFacing==="environment"?"user":"environment";
  if(camStream) camStream.getTracks().forEach(t=>t.stop());
  openCam();
}
function takePhoto(){
  snap.width=cam.videoWidth;
  snap.height=cam.videoHeight;
  snap.getContext("2d").drawImage(cam,0,0);
}

/* ====== Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ====== */
function saveProduct(){
  let img=snap.toDataURL("image/png");
  products.push({
    name:pName.value,
    code:pCode.value,
    price:+pPrice.value,
    img
  });
  localStorage.setItem("products",JSON.stringify(products));
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
  renderProducts();
}
function renderProducts(){
  productsGrid.innerHTML="";
  products.forEach((p,i)=>{
    productsGrid.innerHTML+=`
    <div class="product">
      <img src="${p.img}">
      <b>${p.name}</b>
      <small>${p.price}</small>
      <div class="actions">
        <button class="success" onclick="sell(${i})">âœ…</button>
        <button class="danger">âŒ</button>
      </div>
    </div>`;
  });
}
renderProducts();

/* ====== Ø¨ÙŠØ¹ ====== */
function sell(i){
  let p=products[i];
  invoice.push(p);
  let d=new Date().toLocaleDateString();
  daily[d]=daily[d]||{};
  daily[d][p.code]=(daily[d][p.code]||0)+1;
  localStorage.setItem("daily",JSON.stringify(daily));
  renderInvoice();
  renderDaily();
}

/* ====== ÙØ§ØªÙˆØ±Ø© ====== */
function renderInvoice(){
  invoiceList.innerHTML="";
  let total=0;
  invoice.forEach(p=>{
    total+=p.price;
    invoiceList.innerHTML+=`<div>${p.name} - ${p.price}</div>`;
  });
  let disc=+discount.value||0;
  total=total*(1-disc/100);
  invoiceList.innerHTML+=`<hr><b>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total}</b>`;
}
discount.oninput=renderInvoice;
function printInvoice(){
  if(!activated){alert("ÙŠÙ„Ø²Ù… Ø§Ù„ØªÙØ¹ÙŠÙ„");return;}
  window.print();
}

/* ====== ÙŠÙˆÙ…ÙŠ ====== */
function renderDaily(){
  dailyList.innerHTML="";
  Object.keys(daily).forEach(d=>{
    dailyList.innerHTML+=`<b>${d}</b><br>`;
    Object.keys(daily[d]).forEach(c=>{
      dailyList.innerHTML+=`ÙƒÙˆØ¯ ${c} â†’ ${daily[d][c]}<br>`;
    });
    dailyList.innerHTML+="<hr>";
  });
}
renderDaily();

/* ====== ØªØ¨ÙˆÙŠØ¨Ø§Øª ====== */
function showTab(t,btn){
  document.querySelectorAll("main .card").forEach(c=>c.classList.add("hidden"));
  document.getElementById("tab"+t).classList.remove("hidden");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}
</script>

</body>
</html>