<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…ÙˆÙ„ Ø¯Ø§Ù…Ø§Ø³ÙƒÙŠÙ†Ùˆ PRO - ÙƒØ§Ø´ÙŠØ±</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="theme-color" content="#0ea5e9">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Damaskino PRO">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
/* ===== GLOBAL RESET & VARIABLES ===== */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;-webkit-tap-highlight-color:transparent;}
html,body{width:100%;height:100%;background:#0a0a0a;overflow:hidden;}
body{display:flex;flex-direction:column;min-height:100dvh;}
button{cursor:pointer;color:#fff;}
.tab{display:none;}
/* ===== LOGIN ===== */
.login-screen{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:16px;background:linear-gradient(135deg,#0c4a6e,#4c1d95);}
.login-card{width:100%;max-width:420px;padding:2.2rem;border-radius:22px;background:#0f172a;box-shadow:0 20px 50px rgba(0,0,0,.6);}
.login-title{text-align:center;font-size:2rem;font-weight:900;color:#fff;}
.login-input{width:100%;padding:1.2rem;border-radius:14px;border:none;margin-top:1.5rem;font-size:1.1rem;text-align:center;}
.login-btn{margin-top:1.5rem;width:100%;padding:1.2rem;border-radius:14px;border:none;font-size:1.1rem;font-weight:700;background:linear-gradient(135deg,#0ea5e9,#8b5cf6);color:#fff;}
/* ===== APP ===== */
.app-container{display:none;flex:1;flex-direction:column;height:100dvh;overflow:hidden;}
.header{flex-shrink:0;padding:12px 16px;background:#0f172a;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.08);}
.header h1{font-size:1.1rem;color:#fff;}
.nav-container{flex-shrink:0;background:#0f172a;border-bottom:1px solid rgba(255,255,255,.08);}
.nav-scroll{display:flex;overflow-x:auto;gap:6px;padding:10px;}
.nav-tab{flex:0 0 auto;padding:10px 14px;border-radius:14px;background:#1e293b;color:#e5e7eb;border:none;font-size:.9rem;white-space:nowrap;}
.nav-tab.active{background:linear-gradient(135deg,#0ea5e9,#8b5cf6);color:#fff;}
.main-content{flex:1;overflow-y:auto;padding:16px;}
.card{background:#111827;border-radius:20px;padding:18px;margin-bottom:16px;color:#fff;}
.form-control{width:100%;padding:14px;border-radius:14px;border:none;margin-top:8px;background:#1e293b;color:#fff;font-size:1rem;}
.btn{width:100%;padding:14px;border-radius:14px;border:none;font-size:1rem;margin-top:12px;}
.btn-primary{background:linear-gradient(135deg,#0ea5e9,#8b5cf6);color:#fff;}
#camera-preview{width:100%;border-radius:14px;margin-top:10px;background:#000;}
/* ===== MOBILE ===== */
@media(max-width:768px){.login-title{font-size:1.8rem}.nav-tab{font-size:.85rem}.header h1{font-size:1rem}}

/* ===== ADDITIONAL STYLES FOR NEW FEATURES ===== */
.sale-toggle{display:flex;gap:10px;margin-top:1rem;}
.toggle-btn{flex:1;padding:12px;border:2px solid;background:transparent;color:#fff;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;}
.toggle-sold{border-color:#10b981;color:#10b981;}
.toggle-sold.active{background:#10b981;color:#fff;}
.toggle-unsold{border-color:#ef4444;color:#ef4444;}
.toggle-unsold.active{background:#ef4444;color:#fff;}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="login-screen">
  <div class="login-card">
    <h1 class="login-title">Ù…ÙˆÙ„ Ø¯Ø§Ù…Ø§Ø³ÙƒÙŠÙ†Ùˆ PRO</h1>
    <input class="login-input" id="password-input" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="login-btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<!-- APP -->
<div class="app-container" id="app-container">

<header class="header"><h1>ÙƒØ§Ø´ÙŠØ± Ø¯Ø§Ù…Ø§Ø³ÙƒÙŠÙ†Ùˆ</h1></header>

<nav class="nav-container">
  <div class="nav-scroll">
    <button class="nav-tab active" onclick="showTab('add')">Ø¥Ø¶Ø§ÙØ©</button>
    <button class="nav-tab" onclick="showTab('search')">Ø¨Ø­Ø«</button>
    <button class="nav-tab" onclick="showTab('all')">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯</button>
    <button class="nav-tab" onclick="showTab('daily')">Ø§Ù„Ù…Ø¨ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
    <button class="nav-tab" onclick="showTab('invoice')">ÙØ§ØªÙˆØ±Ø©</button>
  </div>
</nav>

<main class="main-content">
  <!-- ADD PRODUCT -->
  <div class="card tab" id="add">
    <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
    <input class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" id="add-name">
    <input class="form-control" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬" id="add-code">
    <input class="form-control" placeholder="Ø§Ù„Ø³Ø¹Ø±" type="number" id="add-price">
    <div>
      <video id="camera-preview" autoplay playsinline></video>
      <button class="btn btn-primary" onclick="toggleCamera()">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
    </div>
    <button class="btn btn-primary" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
    <div style="margin-top:10px;">
      <button class="btn" onclick="markSold(true)">âœ… ØªÙ… Ø¨ÙŠØ¹Ù‡</button>
      <button class="btn" onclick="markSold(false)">âŒ Ù„Ù… ÙŠØªÙ… Ø¨ÙŠØ¹Ù‡</button>
    </div>
  </div>

  <!-- SEARCH -->
  <div class="card tab" id="search">
    <h3>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù…Ù†ØªØ¬</h3>
    <input class="form-control" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯" id="search-code">
    <input class="form-control" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø³Ø¹Ø±" type="number" id="search-price">
    <button class="btn btn-primary" onclick="searchProduct()">Ø¨Ø­Ø«</button>
    <div id="search-results" style="margin-top:10px;"></div>
  </div>

  <!-- ALL PRODUCTS -->
  <div class="card tab" id="all">
    <h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯</h3>
    <div id="all-products"></div>
  </div>

  <!-- DAILY SALES -->
  <div class="card tab" id="daily">
    <h3>Ø§Ù„Ù…Ø¨ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
    <div id="daily-sales"></div>
  </div>

  <!-- INVOICE -->
  <div class="card tab" id="invoice">
    <h3>ÙØ§ØªÙˆØ±Ø©</h3>
    <select id="invoice-product" class="form-control"></select>
    <input class="form-control" placeholder="Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¹" type="number" id="invoice-qty">
    <input class="form-control" placeholder="Ø®ØµÙ… %" type="number" id="invoice-discount">
    <button class="btn btn-primary" onclick="generateInvoice()">Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
    <div id="invoice-result" style="margin-top:10px;"></div>
  </div>
</main>
</div>

<script>
/* ================= LOGIN ================= */
function login(){
  document.getElementById('login-screen').style.display='none';
  document.getElementById('app-container').style.display='flex';
}

/* ================= TABS ================= */
function showTab(tabId){
  document.querySelectorAll('.tab').forEach(t=>t.style.display='none');
  document.getElementById(tabId).style.display='block';
  document.querySelectorAll('.nav-tab').forEach(btn=>btn.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

/* ================= ACTIVATION ================= */
const ACTIVATION_CODE='0952725590';
let activated=localStorage.getItem('activated')==='true';
function requireActivation(){if(!activated){alert('Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø­Ø§Ø¬Ø© Ù„ØªÙØ¹ÙŠÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ù„Ù…ÙŠØ²Ø§Øª!');}}

/* ================= PRODUCTS STORAGE ================= */
let products=JSON.parse(localStorage.getItem('products')||'[]');
let dailySales=JSON.parse(localStorage.getItem('dailySales')||'[]');
let salesBackup=JSON.parse(localStorage.getItem('salesBackup')||'[]');
let cameraFacing='environment';
let videoStream;

function refreshAllProducts(){
  let container=document.getElementById('all-products');
  container.innerHTML='';
  products.forEach((p,i)=>{
    container.innerHTML+=`<div style="border:1px solid #555;padding:10px;margin-bottom:5px;border-radius:10px;">
      <strong>${p.name}</strong> | ${p.code} | ${p.price} | ${p.sold?'âœ…':'âŒ'}
      <button onclick="editProduct(${i})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
      <button onclick="deleteProduct(${i})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    </div>`;
  });
  refreshInvoiceSelect();
}

function refreshInvoiceSelect(){
  let select=document.getElementById('invoice-product');
  select.innerHTML='';
  products.forEach((p,i)=>{select.innerHTML+=`<option value="${i}">${p.name} - ${p.price}</option>`});
}

/* ================= ADD PRODUCT ================= */
function addProduct(){
  requireActivation();
  let name=document.getElementById('add-name').value;
  let code=document.getElementById('add-code').value;
  let price=parseFloat(document.getElementById('add-price').value);
  if(!name||!code||isNaN(price)){alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');return;}
  products.push({name,code,price,sold:false});
  localStorage.setItem('products',JSON.stringify(products));
  refreshAllProducts();
  document.getElementById('add-name').value='';
  document.getElementById('add-code').value='';
  document.getElementById('add-price').value='';
}

/* ================= MARK SOLD ================= */
function markSold(flag){
  let last=products[products.length-1];
  if(last){last.sold=flag;localStorage.setItem('products',JSON.stringify(products));refreshDailySales();}
}

/* ================= SEARCH ================= */
function searchProduct(){
  requireActivation();
  let code=document.getElementById('search-code').value;
  let price=document.getElementById('search-price').value;
  let results=products.filter(p=>(code?p.code.includes(code):true) && (price?p.price==price:true));
  let container=document.getElementById('search-results');
  if(results.length===0){container.innerHTML='Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬'; return;}
  container.innerHTML='';
  results.forEach(p=>{container.innerHTML+=`<div>${p.name} | ${p.code} | ${p.price} | ${p.sold?'âœ…':'âŒ'}</div>`});
}

/* ================= EDIT / DELETE ================= */
function editProduct(i){
  let newName=prompt('Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯',products[i].name);
  let newCode=prompt('ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯',products[i].code);
  let newPrice=parseFloat(prompt('Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯',products[i].price));
  if(newName && newCode && !isNaN(newPrice)){
    products[i]={...products[i],name:newName,code:newCode,price:newPrice};
    localStorage.setItem('products',JSON.stringify(products));
    refreshAllProducts();
  }
}
function deleteProduct(i){
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ')){
    let removed=products.splice(i,1)[0];
    if(removed.sold){
      salesBackup.push({code:removed.code,date:new Date().toISOString().slice(0,10),qty:1});
      localStorage.setItem('salesBackup',JSON.stringify(salesBackup));
    }
    localStorage.setItem('products',JSON.stringify(products));
    refreshAllProducts();
    refreshDailySales();
  }
}

/* ================= DAILY SALES ================= */
function refreshDailySales(){
  let today=new Date().toISOString().slice(0,10);
  dailySales=products.filter(p=>p.sold).map(p=>({...p,date:today}));
  localStorage.setItem('dailySales',JSON.stringify(dailySales));
  let container=document.getElementById('daily-sales');
  container.innerHTML='';
  dailySales.forEach(p=>{container.innerHTML+=`<div>${p.name} | ${p.code} | ${p.price}</div>`});
}

/* ================= INVOICE ================= */
function generateInvoice(){
  requireActivation();
  let index=document.getElementById('invoice-product').value;
  let qty=parseInt(document.getElementById('invoice-qty').value);
  let discount=parseFloat(document.getElementById('invoice-discount').value)||0;
  if(isNaN(qty)||qty<=0){alert('Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­'); return;}
  let product=products[index];
  let total=product.price*qty*(1-discount/100);
  document.getElementById('invoice-result').innerHTML=`
    <div>
      Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©: ${product.name}<br>
      ÙƒÙˆØ¯ Ø§Ù„Ù…Ø§Ø¯Ø©: ${product.code}<br>
      Ø§Ù„Ø¹Ø¯Ø¯: ${qty}<br>
      Ø§Ù„Ø®ØµÙ…: ${discount}%<br>
      Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${total.toFixed(2)}<br>
      <button onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
    </div>`;
}

/* ================= CAMERA ================= */
async function toggleCamera(){
  cameraFacing=cameraFacing==='environment'?'user':'environment';
  if(videoStream){videoStream.getTracks().forEach(t=>t.stop());}
  try{
    videoStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:cameraFacing}});
    document.getElementById('camera-preview').srcObject=videoStream;
  }catch(err){alert('ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù„Ù„Ù…Ø·ÙˆØ± Ù„Ù„ØªÙØ¹ÙŠÙ„ ');}
}
(async()=>{await toggleCamera();})();

/* ================= ACTIVATION PROMPT ================= */
function activateProgram(){
  let code=prompt('Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„:');
  if(code===ACTIVATION_CODE){activated=true; localStorage.setItem('activated','true'); alert('ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');}
  else{alert('ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­');}
}

/* ================= INIT ================= */
refreshAllProducts();
refreshDailySales();
</script>

<button style="position:fixed;bottom:10px;right:10px;padding:10px;background:#0ea5e9;border:none;border-radius:10px;" onclick="activateProgram()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</button>

</body>
</html>