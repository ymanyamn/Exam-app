<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>حظوري - نظام حضور متكامل</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #000000;
            --bg-main: #0f0f0f;
            --bg-card: #1a1a1a;
            --bg-input: #262626;
            --accent: #f97316;
            --accent-hover: #fb923c;
            --accent-glow: rgba(249, 115, 22, 0.4);
            --accent-soft: rgba(249, 115, 22, 0.1);
            --success: #22c55e;
            --success-soft: rgba(34, 197, 94, 0.15);
            --danger: #ef4444;
            --danger-soft: rgba(239, 68, 68, 0.15);
            --text-main: #ffffff;
            --text-sec: #a3a3a3;
            --text-muted: #525252;
            --border: #2a2a2a;
            
            /* ألوان زر الراتب */
            --salary-primary: #4CAF50;
            --salary-primary-dark: #2e7d32;
            --salary-glow: rgba(76, 175, 80, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            font-family: 'Tajawal', sans-serif;
            background: var(--bg-body);
            color: var(--text-main);
            overflow: hidden;
        }

        /* Layout Structure */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 500px;
            margin: 0 auto;
            background: var(--bg-main);
            position: relative;
            overflow: hidden;
        }

        /* Ambient Light Effect */
        .ambient-light {
            position: absolute;
            top: -50%;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
            opacity: 0.4;
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        .header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
            position: relative;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(to bottom, var(--bg-main), transparent);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand-icon {
            width: 42px;
            height: 42px;
            background: var(--accent);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px -5px var(--accent-glow);
        }

        .brand-icon svg {
            width: 22px;
            height: 22px;
            color: #000;
        }

        .brand-name {
            font-size: 26px;
            font-weight: 900;
            color: var(--text-main);
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .icon-btn:active {
            transform: scale(0.94);
            border-color: var(--accent);
        }

        .icon-btn svg {
            width: 20px;
            height: 20px;
            color: var(--text-sec);
        }

        /* Main Scrollable Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 24px 20px;
            padding-bottom: 120px; /* زيادة المسافة للشاشات الصغيرة */
            z-index: 1;
            position: relative;
        }

        .main-content::-webkit-scrollbar { width: 0; }

        /* Sections */
        .section {
            margin-bottom: 24px;
            animation: fadeUp 0.5s ease backwards;
        }

        .section:nth-child(1) { animation-delay: 0.05s; }
        .section:nth-child(2) { animation-delay: 0.1s; }
        .section:nth-child(3) { animation-delay: 0.15s; }
        .section:nth-child(4) { animation-delay: 0.2s; }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Time Widget */
        .time-widget {
            text-align: center;
            padding: 32px 0;
            position: relative;
        }

        .live-time {
            font-size: 64px;
            font-weight: 900;
            color: var(--text-main);
            letter-spacing: -2px;
            font-variant-numeric: tabular-nums;
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 0 0 40px var(--accent-glow);
        }

        .live-date {
            font-size: 16px;
            color: var(--text-sec);
            font-weight: 500;
            margin-bottom: 20px;
        }

        .credit-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 30px;
            font-size: 13px;
            color: var(--text-sec);
        }

        .credit-badge span {
            color: var(--accent);
            font-weight: 700;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            font-size: 15px;
            font-weight: 700;
        }

        .card-header svg {
            width: 18px;
            height: 18px;
            color: var(--accent);
        }

        /* Form Elements */
        .field-group {
            margin-bottom: 16px;
        }

        .field-group:last-child {
            margin-bottom: 0;
        }

        .field-label {
            display: block;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .field-input {
            width: 100%;
            padding: 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-main);
            font-family: inherit;
            outline: none;
            transition: all 0.2s;
        }

        .field-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft);
        }

        .field-input::placeholder {
            color: var(--text-muted);
        }

        .field-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .field-hint {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: var(--accent-soft);
            border-radius: 8px;
            font-size: 12px;
            color: var(--accent);
            font-weight: 600;
            margin-top: 12px;
        }

        /* Fixed Bottom Bar - محسن للشاشات الصغيرة */
        .bottom-action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, var(--bg-main) 90%, transparent);
            padding: 12px 16px 20px;
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        @media (min-width: 501px) {
            .bottom-action-bar {
                max-width: 500px;
                left: 50%;
                transform: translateX(-50%);
                padding: 16px 20px 28px;
            }
        }

        /* حاوية الأزرار الثلاثة - محسنة */
        .three-buttons-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 6px;
            width: 100%;
            margin-bottom: 8px;
        }

        /* تنسيق الأزرار الثلاثة */
        .nav-btn {
            padding: 12px 6px;
            background: var(--bg-card);
            color: var(--text-main);
            border: 1px solid var(--border);
            border-radius: 40px; /* شكل دائري */
            font-size: 13px;
            font-weight: 700;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 0; /* مهم لمنع تجاوز النص */
            white-space: nowrap;
            flex: 1;
        }

        .nav-btn svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .nav-btn span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nav-btn:active {
            background: var(--bg-input);
            transform: scale(0.96);
        }

        .nav-btn.save-btn {
            background: var(--success);
            color: white;
            border-color: transparent;
        }

        .nav-btn.save-btn:active {
            background: #16a34a;
        }

        .btn-main {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: #000;
            border: none;
            border-radius: 40px;
            font-size: 15px;
            font-weight: 800;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 8px 20px -5px var(--accent-glow);
        }

        .btn-main:active {
            transform: scale(0.98);
        }

        .btn-main svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        /* زر حساب الراتب المحسن والمرتفع */
        .btn-salary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(145deg, var(--salary-primary-dark), var(--salary-primary));
            color: white;
            border: none;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 900;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 12px 25px -5px var(--salary-glow);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            margin-top: 4px;
        }

        .btn-salary svg {
            width: 20px;
            height: 20px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
            flex-shrink: 0;
        }

        .btn-salary:active {
            transform: scale(0.97);
        }

        .glow-effect {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .btn-salary:active .glow-effect {
            opacity: 0.5;
        }

        /* Week View Styles */
        .week-header {
            background: linear-gradient(135deg, var(--accent-soft), transparent);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .week-title {
            font-size: 18px;
            font-weight: 800;
            color: var(--accent);
        }

        .week-range {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .week-stat {
            padding: 6px 12px;
            background: var(--accent);
            color: #000;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 800;
            white-space: nowrap;
        }

        .day-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .day-card.weekend {
            background: linear-gradient(135deg, var(--accent-soft), var(--bg-card));
            border-color: rgba(249, 115, 22, 0.3);
        }

        .day-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .day-name {
            font-weight: 700;
            font-size: 16px;
        }

        .day-card.weekend .day-name {
            color: var(--accent);
        }

        .day-date {
            font-size: 11px;
            color: var(--text-muted);
            background: var(--bg-input);
            padding: 4px 8px;
            border-radius: 20px;
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .input-box {
            background: var(--bg-input);
            border-radius: 16px;
            padding: 10px 12px;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .input-box:focus-within {
            border-color: var(--accent);
        }

        .input-label-sm {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 4px;
            display: block;
        }

        .input-time {
            width: 100%;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-main);
            font-family: inherit;
            outline: none;
        }

        .status-tags {
            display: flex;
            gap: 6px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
        }

        .tag-late {
            background: var(--danger-soft);
            color: var(--danger);
        }

        .tag-extra {
            background: var(--success-soft);
            color: var(--success);
        }

        .tag-ok {
            background: var(--accent-soft);
            color: var(--accent);
        }

        /* Modals */
        .modal-layer {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 16px;
        }

        .modal-layer.active { display: flex; }

        .modal-box {
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 28px;
            width: 100%;
            max-width: 360px;
            overflow: hidden;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-head {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .modal-head h2 {
            font-size: 18px;
            font-weight: 800;
            color: var(--accent);
        }

        .modal-content {
            padding: 20px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 20px;
            background: var(--bg-card);
            display: flex;
            justify-content: space-between;
        }

        .modal-close-foot {
            padding: 16px 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-row:last-child { border: none; }

        .summary-lbl { color: var(--text-muted); font-size: 12px; font-weight: 600; }
        .summary-val { font-weight: 800; font-size: 14px; }
        .summary-val.neg { color: var(--danger); }
        .summary-val.pos { color: var(--success); }

        .total-strip {
            background: var(--accent-soft);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-strip span:first-child { font-weight: 600; color: var(--text-sec); }
        .total-strip span:last-child { font-weight: 900; font-size: 18px; color: var(--accent); }

        /* Activation */
        .act-icon-box {
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            box-shadow: 0 8px 20px var(--accent-glow);
        }

        .act-icon-box svg { width: 24px; height: 24px; color: #000; }

        .act-text { text-align: center; color: var(--text-sec); margin-bottom: 16px; font-size: 13px; }

        .act-input {
            width: 100%;
            padding: 14px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-main);
            text-align: center;
            font-weight: 700;
            font-size: 16px;
            letter-spacing: 2px;
            outline: none;
        }

        .act-err { color: var(--danger); font-size: 11px; text-align: center; margin-top: 8px; height: 12px; }

        /* Backup */
        .backup-textarea {
            width: 100%;
            height: 100px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-main);
            padding: 12px;
            font-family: monospace;
            font-size: 10px;
            resize: none;
            outline: none;
            direction: ltr;
            margin-bottom: 12px;
        }

        /* Dev Badge */
        .dev-badge {
            position: fixed;
            bottom: 100px;
            left: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 10px 14px;
            font-size: 11px;
            z-index: 5;
            opacity: 0.8;
            pointer-events: none;
        }

        .dev-badge div:first-child { color: var(--accent); font-weight: 700; }
        .dev-badge div:last-child { color: var(--text-muted); font-family: monospace; font-size: 10px; }

        /* Toast */
        .toast-msg {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--success);
            color: white;
            padding: 12px 24px;
            border-radius: 40px;
            font-weight: 700;
            z-index: 150;
            opacity: 0;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.3);
            white-space: nowrap;
        }

        .toast-msg.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Responsive Adjustments - محسنة */
        @media (max-width: 480px) {
            .live-time { font-size: 48px; }
            .field-row { grid-template-columns: 1fr; }
            .inputs-grid { grid-template-columns: 1fr; }
            
            .three-buttons-container {
                gap: 4px;
            }
            
            .nav-btn {
                padding: 10px 4px;
                font-size: 12px;
                border-radius: 30px;
            }
            
            .nav-btn svg {
                width: 12px;
                height: 12px;
            }
            
            .btn-salary {
                padding: 14px;
                font-size: 15px;
            }
            
            .btn-salary svg {
                width: 18px;
                height: 18px;
            }
            
            .main-content {
                padding-bottom: 130px;
            }
        }

        @media (max-width: 360px) {
            .nav-btn {
                padding: 8px 3px;
                font-size: 11px;
            }
            
            .nav-btn svg {
                display: none; /* إخفاء الأيقونات في الشاشات الصغيرة جداً */
            }
            
            .btn-salary {
                padding: 12px;
                font-size: 14px;
            }
            
            .week-title {
                font-size: 16px;
            }
            
            .week-stat {
                padding: 4px 8px;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="ambient-light"></div>
    
    <!-- DEV BADGE -->
    <div class="dev-badge">
        <div>يمان محمد حسين</div>
        <div>0952725590</div>
    </div>

    <div class="toast-msg" id="toast">تم الحفظ</div>

    <!-- SETUP SCREEN -->
    <div class="screen active" id="setupScreen">
        <div class="header">
            <div class="brand">
                <div class="brand-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2m6-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <span class="brand-name">حظوري</span>
            </div>
            <button class="icon-btn" onclick="openBackup()">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
            </button>
        </div>

        <div class="main-content">
            <div class="section">
                <div class="time-widget">
                    <div class="live-time" id="clockTime">00:00</div>
                    <div class="live-date" id="clockDate">التاريخ</div>
                    <div class="credit-badge">برمجة <span>يمان محمد حسين</span></div>
                </div>
            </div>

            <div class="section">
                <div class="card">
                    <div class="card-header">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        الراتب الشهري (ل.س)
                    </div>
                    <div class="field-group">
                        <input type="number" class="field-input" id="salaryInput" placeholder="أدخل راتبك الشهري" value="500000">
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="card">
                    <div class="card-header">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        ساعات العمل
                    </div>
                    <div class="field-group">
                        <label class="field-label">عدد الساعات اليومية</label>
                        <input type="number" class="field-input" id="workHoursInput" placeholder="8" min="1" max="24" value="8">
                    </div>
                    <div class="field-hint">
                        <svg width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        احسب من البداية حتى النهاية
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="card">
                    <div class="card-header">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        أوقات الدوام
                    </div>
                    <div class="field-row">
                        <div class="field-group">
                            <label class="field-label">البداية</label>
                            <input type="time" class="field-input" id="startTimeInput" value="08:00">
                        </div>
                        <div class="field-group">
                            <label class="field-label">النهاية</label>
                            <input type="time" class="field-input" id="endTimeInput" value="16:00">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-action-bar">
            <button class="btn-main" onclick="startApp()">
                <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                بدء التسجيل
            </button>
        </div>
    </div>

    <!-- WEEKLY SCREEN -->
    <div class="screen" id="weeklyScreen">
        <div class="header">
            <div class="brand">
                <div class="brand-icon">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2m6-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <span class="brand-name">حظوري</span>
            </div>
            <button class="icon-btn" onclick="openBackup()">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
            </button>
        </div>

        <div class="main-content">
            <div class="week-header">
                <div>
                    <div class="week-title" id="weekTitle">الأسبوع الأول</div>
                    <div class="week-range" id="weekDates">التاريخ</div>
                </div>
                <div class="week-stat">7 أيام</div>
            </div>
            <div id="daysContainer"></div>
        </div>

        <div class="bottom-action-bar">
            <!-- الأزرار الثلاثة في حاوية منفصلة مع تنسيق محسن -->
            <div class="three-buttons-container">
                <button class="nav-btn" onclick="prevWeek()">
                    <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                    <span>السابق</span>
                </button>
                <button class="nav-btn save-btn" onclick="saveData()">
                    <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
                    <span>حفظ</span>
                </button>
                <button class="nav-btn" onclick="nextWeek()">
                    <span>التالي</span>
                    <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
                </button>
            </div>
            
            <!-- زر حساب الراتب -->
            <button class="btn-salary" onclick="openSalary()">
                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>حساب الراتب</span>
                <div class="glow-effect"></div>
            </button>
        </div>
    </div>
</div>

<!-- Modals -->
<div class="modal-layer" id="salaryModal">
    <div class="modal-box">
        <div class="modal-head"><h2>ملخص الراتب</h2></div>
        <div class="modal-content" id="salaryBody"></div>
        <div class="total-strip">
            <span>صافي الأسبوع</span>
            <span id="totalVal">0 ل.س</span>
        </div>
        <div class="modal-close-foot">
            <button class="nav-btn" style="width:100%" onclick="closeModal('salaryModal')">إغلاق</button>
        </div>
    </div>
</div>

<div class="modal-layer" id="activationModal">
    <div class="modal-box">
        <div class="modal-head"><h2>تفعيل البرنامج</h2></div>
        <div class="modal-content" style="text-align:center">
            <div class="act-icon-box">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            </div>
            <p class="act-text">أدخل كود التفعيل للاستمرار</p>
            <input type="text" class="act-input" id="codeInput" placeholder="كود التفعيل">
            <p class="act-err" id="actErr"></p>
            <button class="btn-main" style="margin-top:16px" onclick="activate()">تفعيل</button>
        </div>
    </div>
</div>

<div class="modal-layer" id="backupModal">
    <div class="modal-box">
        <div class="modal-head"><h2>نسخ احتياطي</h2></div>
        <div class="modal-content">
            <div class="three-buttons-container" style="margin-bottom:16px">
                <button class="nav-btn save-btn" onclick="exportData()">تصدير</button>
                <button class="nav-btn" onclick="importData()">استيراد</button>
            </div>
            <textarea class="backup-textarea" id="backupArea" placeholder="كود النسخة سيظهر هنا..."></textarea>
            <p style="font-size:11px; color:var(--text-muted); text-align:center">انسخ الكود واحفظه بأمان</p>
        </div>
        <div class="modal-close-foot">
            <button class="nav-btn" style="width:100%" onclick="closeModal('backupModal')">إغلاق</button>
        </div>
    </div>
</div>

<script>
    const state = {
        salary: 500000, 
        hours: 8, 
        start: '08:00', 
        end: '16:00', 
        week: 0, 
        weeks: [], 
        activated: false
    };

    const CODE = '0952725590';
    const DAYS = ['السبت', 'الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة'];
    const WEEKEND = [0, 6];
    const CUR = ' ل.س';

    function init() {
        updateTime();
        setInterval(updateTime, 1000);
        load();
    }

    function updateTime() {
        const n = new Date();
        const h = String(n.getHours()).padStart(2, '0');
        const m = String(n.getMinutes()).padStart(2, '0');
        const s = String(n.getSeconds()).padStart(2, '0');
        const tEl = document.getElementById('clockTime');
        if (tEl) tEl.textContent = `${h}:${m}:${s}`;
        
        const dEl = document.getElementById('clockDate');
        if (dEl) dEl.textContent = n.toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }

    function fmtN(n) { return Math.round(n).toLocaleString('ar-SY'); }

    function toMin(t) { if(!t) return 0; const p=t.split(':'); return parseInt(p[0])*60+parseInt(p[1]); }

    function fmtDur(m) {
        if(m<=0) return '0 د';
        const h=Math.floor(m/60), n=m%60;
        if(h>0 && n>0) return `${h}س ${n}د`;
        if(h>0) return `${h} ساعة`;
        return `${n} دقيقة`;
    }

    function createW() {
        const t = new Date();
        const d = (t.getDay()+1)%7;
        const s = new Date(t);
        s.setDate(t.getDate()-d);
        const w = { start: s.toISOString(), days: [] };
        for(let i=0; i<7; i++) {
            const dd = new Date(s);
            dd.setDate(s.getDate()+i);
            w.days.push({ name: DAYS[i], date: dd.toISOString(), in: '', out: '', late: 0, extra: 0, st: '' });
        }
        return w;
    }

    function calcSt(i) {
        const w = state.weeks[state.week];
        if(!w) return;
        const d = w.days[i];
        if(!d || !d.in || !d.out) return;
        
        d.late = 0; d.extra = 0; d.st = '';
        
        const es = toMin(state.start), ee = toMin(state.end);
        const as = toMin(d.in), ae = toMin(d.out);
        
        if(as > es) d.late = as - es;
        if(ae > ee) d.extra = ae - ee;
        
        if(d.late>0 && d.extra>0) d.st = 'mix';
        else if(d.late>0) d.st = 'late';
        else if(d.extra>0) d.st = 'extra';
        else d.st = 'ok';
    }

    function renderW() {
        const w = state.weeks[state.week];
        if(!w) return;
        
        document.getElementById('weekTitle').textContent = `الأسبوع ${state.week + 1}`;
        const sd = new Date(w.start);
        const ed = new Date(sd);
        ed.setDate(sd.getDate()+6);
        const op = { month: 'short', day: 'numeric' };
        document.getElementById('weekDates').textContent = `${sd.toLocaleDateString('ar-SA', op)} - ${ed.toLocaleDateString('ar-SA', op)}`;

        const c = document.getElementById('daysContainer');
        c.innerHTML = '';
        
        w.days.forEach((d, i) => {
            const dd = new Date(d.date);
            const isW = WEEKEND.includes(i);
            const ds = dd.toLocaleDateString('ar-SA', { day: 'numeric', month: 'short' });
            
            let tg = '';
            if(d.st === 'late') tg = `<span class="tag tag-late">تأخر ${fmtDur(d.late)}</span>`;
            else if(d.st === 'extra') tg = `<span class="tag tag-extra">إضافي ${fmtDur(d.extra)}</span>`;
            else if(d.st === 'mix') tg = `<span class="tag tag-late">تأخر ${fmtDur(d.late)}</span><span class="tag tag-extra">إضافي ${fmtDur(d.extra)}</span>`;
            else if(d.st === 'ok') tg = `<span class="tag tag-ok">منتظم</span>`;

            const cd = document.createElement('div');
            cd.className = `day-card${isW ? ' weekend' : ''}`;
            cd.innerHTML = `
                <div class="day-top">
                    <span class="day-name">${d.name}</span>
                    <span class="day-date">${ds}</span>
                </div>
                <div class="inputs-grid">
                    <div class="input-box">
                        <label class="input-label-sm">الحضور</label>
                        <input type="time" class="input-time" value="${d.in}" onchange="updD(${i},'in',this.value)">
                    </div>
                    <div class="input-box">
                        <label class="input-label-sm">المغادرة</label>
                        <input type="time" class="input-time" value="${d.out}" onchange="updD(${i},'out',this.value)">
                    </div>
                </div>
                <div class="status-tags">${tg}</div>
            `;
            c.appendChild(cd);
        });
    }

    function updD(i, f, v) {
        const w = state.weeks[state.week];
        if(w && w.days[i]) {
            w.days[i][f] = v;
            calcSt(i);
            renderW();
        }
    }

    function saveData() { save(); toast('تم الحفظ بنجاح'); }
    function save() { localStorage.setItem('hozori', JSON.stringify(state)); }
    
    function load() {
        const d = localStorage.getItem('hozori');
        if(d) {
            try {
                const p = JSON.parse(d);
                if(p.salary && p.weeks && p.weeks.length > 0) {
                    Object.assign(state, p);
                    if(state.activated) {
                        document.getElementById('setupScreen').classList.remove('active');
                        document.getElementById('weeklyScreen').classList.add('active');
                        renderW();
                    }
                }
            } catch(e) {}
        }
    }

    function toast(m) {
        const t = document.getElementById('toast');
        t.textContent = m;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
    }

    function prevWeek() {
        if(state.week > 0) {
            state.week--;
            renderW();
        }
    }

    function nextWeek() {
        if(state.week < state.weeks.length - 1) {
            state.week++;
        } else {
            state.weeks.push(createW());
            state.week = state.weeks.length - 1;
        }
        renderW();
    }

    function calcSal() {
        const w = state.weeks[state.week];
        if(!w) return null;
        let l=0, e=0, dys=0;
        w.days.forEach(d => {
            if(d.in && d.out) {
                l += d.late; e += d.extra; dys++;
            }
        });
        const hr = state.salary / (state.hours * 30);
        const mr = hr / 60;
        const lc = l * mr;
        const ep = e * mr * 1.5;
        const base = state.salary / 4;
        return { dys, l, e, lc, ep, base, net: base - lc + ep };
    }

    function openSalary() {
        const d = calcSal();
        if(!d) {
            toast('لا توجد بيانات كافية');
            return;
        }
        document.getElementById('salaryBody').innerHTML = `
            <div class="summary-row"><span class="summary-lbl">أيام العمل</span><span class="summary-val">${d.dys} يوم</span></div>
            <div class="summary-row"><span class="summary-lbl">الراتب الأسبوعي</span><span class="summary-val">${fmtN(d.base)}${CUR}</span></div>
            <div class="summary-row"><span class="summary-lbl">خصم التأخر</span><span class="summary-val neg">- ${fmtN(d.lc)}${CUR}</span></div>
            <div class="summary-row"><span class="summary-lbl">مكافأة الإضافي</span><span class="summary-val pos">+ ${fmtN(d.ep)}${CUR}</span></div>
        `;
        document.getElementById('totalVal').textContent = `${fmtN(d.net)}${CUR}`;
        document.getElementById('salaryModal').classList.add('active');
    }

    function openBackup() {
        document.getElementById('backupArea').value = '';
        document.getElementById('backupModal').classList.add('active');
    }

    function exportData() {
        document.getElementById('backupArea').value = JSON.stringify(state);
        toast('تم تصدير البيانات');
    }

    function importData() {
        const v = document.getElementById('backupArea').value.trim();
        if(!v) { toast('الرجاء لصق الكود'); return; }
        try {
            const p = JSON.parse(v);
            if(p.salary && p.weeks) {
                Object.assign(state, p);
                save();
                toast('تم الاستعادة');
                closeModal('backupModal');
                if(state.activated) {
                    document.getElementById('setupScreen').classList.remove('active');
                    document.getElementById('weeklyScreen').classList.add('active');
                    renderW();
                }
            } else { toast('كود غير صالح'); }
        } catch(e) { toast('خطأ في الكود'); }
    }

    function startApp() {
        const sal = parseFloat(document.getElementById('salaryInput').value);
        const hrs = parseInt(document.getElementById('workHoursInput').value);
        const st = document.getElementById('startTimeInput').value;
        const en = document.getElementById('endTimeInput').value;

        if(!sal || sal <= 0) { toast('أدخل الراتب'); return; }
        if(!hrs || hrs <= 0) { toast('أدخل الساعات'); return; }
        if(!st) { toast('أدخل وقت البدء'); return; }
        if(!en) { toast('أدخل وقت الانتهاء'); return; }

        state.salary = sal;
        state.hours = hrs;
        state.start = st;
        state.end = en;
        state.weeks = [createW()];
        state.week = 0;

        if(!state.activated) {
            save();
            document.getElementById('activationModal').classList.add('active');
            return;
        }

        document.getElementById('setupScreen').classList.remove('active');
        document.getElementById('weeklyScreen').classList.add('active');
        renderW();
        save();
    }

    function activate() {
        const c = document.getElementById('codeInput').value.trim();
        const e = document.getElementById('actErr');
        if(c === CODE) {
            state.activated = true;
            save();
            closeModal('activationModal');
            document.getElementById('setupScreen').classList.remove('active');
            document.getElementById('weeklyScreen').classList.add('active');
            renderW();
            toast('تم التفعيل');
        } else {
            e.textContent = 'كود غير صحيح';
            document.getElementById('codeInput').value = '';
        }
    }

    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    document.querySelectorAll('.modal-layer').forEach(m => {
        m.addEventListener('click', e => { if(e.target === m) m.classList.remove('active'); });
    });

    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>